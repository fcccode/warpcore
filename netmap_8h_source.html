<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>warpcore: include/net/netmap.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">warpcore
   &#160;<span id="projectnumber">0.21.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5a30104352ef4255dc24354b02eb2d20.html">include</a></li><li class="navelem"><a class="el" href="dir_339b5a841cbce1477d0800db191ae676.html">net</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">netmap.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="netmap_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (C) 2011-2014 Matteo Landi, Luigi Rizzo. All rights reserved.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * modification, are permitted provided that the following conditions</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * are met:</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *   1. Redistributions of source code must retain the above copyright</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *      notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *   2. Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *      notice, this list of conditions and the following disclaimer in the</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *      documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``S IS&#39;&#39;AND</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * SUCH DAMAGE.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * $FreeBSD: head/sys/net/netmap.h 251139 2013-05-30 14:07:14Z luigi $</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * Definitions of constants and the structures used by the netmap</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * framework, for the part visible to both kernel and userspace.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * Detailed info on netmap is available with &quot;man netmap&quot; or at</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> *  http://info.iet.unipi.it/~luigi/netmap/</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * This API is also used to communicate with the VALE software switch</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#ifndef _NET_NETMAP_H_</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define _NET_NETMAP_H_</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="netmap_8h.html#a42a3750856de2a1db0136fc62ffea302">   42</a></span>&#160;<span class="preprocessor">#define NETMAP_API  11      </span><span class="comment">/* current API version */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="netmap_8h.html#a892c50bfeefb1f6d5e82d1824bfc8b7f">   44</a></span>&#160;<span class="preprocessor">#define NETMAP_MIN_API  11      </span><span class="comment">/* min and max versions accepted */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="netmap_8h.html#a7937759eb2ca2e5400e48d6fe9094b0f">   45</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_MAX_API  15</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor"></span><span class="comment">/*</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> * Some fields should be cache-aligned to reduce contention.</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> * The alignment is architecture and OS dependent, but rather than</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"> * digging into OS headers to find the exact value we use an estimate</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> * that should cover most architectures.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="netmap_8h.html#a3b1049947637ce44a5dbc247e570302c">   52</a></span>&#160;<span class="preprocessor">#define NM_CACHE_ALIGN  128</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"> * --- Netmap data structures ---</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"> * The userspace data structures used by netmap are shown below.</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> * They are allocated by the kernel and mmap()ed by userspace threads.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"> * Pointers are implemented as memory offsets or indexes,</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"> * so that they can be easily dereferenced in kernel and userspace.</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">   KERNEL (opaque, obviously)</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">  ====================================================================</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">                                         |</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">   USERSPACE                             |      struct netmap_ring</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">                                         +----&gt;+---------------+</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">                                             / | head,cur,tail |</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">   struct netmap_if (nifp, 1 per fd)        /  | buf_ofs       |</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">    +---------------+                      /   | other fields  |</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">    | ni_tx_rings   |                     /    +===============+</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">    | ni_rx_rings   |                    /     | buf_idx, len  | slot[0]</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">    |               |                   /      | flags, ptr    |</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">    |               |                  /       +---------------+</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">    +===============+                 /        | buf_idx, len  | slot[1]</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">    | txring_ofs[0] | (rel.to nifp)--&#39;         | flags, ptr    |</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">    | txring_ofs[1] |                          +---------------+</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">     (tx+1 entries)                           (num_slots entries)</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">    | txring_ofs[t] |                          | buf_idx, len  | slot[n-1]</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">    +---------------+                          | flags, ptr    |</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">    | rxring_ofs[0] |                          +---------------+</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">    | rxring_ofs[1] |</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">     (rx+1 entries)</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">    | rxring_ofs[r] |</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">    +---------------+</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"> * For each &quot;interface&quot; (NIC, host stack, PIPE, VALE switch port) bound to</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> * a file descriptor, the mmap()ed region contains a (logically readonly)</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> * struct netmap_if pointing to struct netmap_ring&#39;s.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"> * There is one netmap_ring per physical NIC ring, plus one tx/rx ring</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"> * pair attached to the host stack (this pair is unused for non-NIC ports).</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"> * All physical/host stack ports share the same memory region,</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> * so that zero-copy can be implemented between them.</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"> * VALE switch ports instead have separate memory regions.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"> * The netmap_ring is the userspace-visible replica of the NIC ring.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"> * Each slot has the index of a buffer (MTU-sized and residing in the</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"> * mmapped region), its length and some flags. An extra 64-bit pointer</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"> * is provided for user-supplied buffers in the tx path.</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"> * In user space, the buffer address is computed as</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"> *  (char *)ring + buf_ofs + index * NETMAP_BUF_SIZE</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"> * Added in NETMAP_API 11:</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> * + NIOCREGIF can request the allocation of extra spare buffers from</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> *   the same memory pool. The desired number of buffers must be in</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> *   nr_arg3. The ioctl may return fewer buffers, depending on memory</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"> *   availability. nr_arg3 will return the actual value, and, once</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"> *   mapped, nifp-&gt;ni_bufs_head will be the index of the first buffer.</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"> *   The buffers are linked to each other using the first uint32_t</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"> *   as the index. On close, ni_bufs_head must point to the list of</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"> *   buffers to be released.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"> * + NIOCREGIF can request space for extra rings (and buffers)</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"> *   allocated in the same memory space. The number of extra rings</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"> *   is in nr_arg1, and is advisory. This is a no-op on NICs where</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"> *   the size of the memory space is fixed.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment"> * + NIOCREGIF can attach to PIPE rings sharing the same memory</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"> *   space with a parent device. The ifname indicates the parent device,</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"> *   which must already exist. Flags in nr_flags indicate if we want to</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"> *   bind the master or slave side, the index (from nr_ringid)</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"> *   is just a cookie and does not need to be sequential.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"> * + NIOCREGIF can also attach to &#39;monitor&#39; rings that replicate</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"> *   the content of specific rings, also from the same memory space.</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"> *   Extra flags in nr_flags support the above functions.</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"> *   Application libraries may use the following naming scheme:</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"> *  netmap:foo          all NIC ring pairs</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"> *  netmap:foo^         only host ring pair</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"> *  netmap:foo+         all NIC ring + host ring pairs</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"> *  netmap:foo-k            the k-th NIC ring pair</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"> *  netmap:foo{k            PIPE ring pair k, master side</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> *  netmap:foo}k            PIPE ring pair k, slave side</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"> * Some notes about host rings:</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment"> * + The RX host ring is used to store those packets that the host network</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment"> *   stack is trying to transmit through a NIC queue, but only if that queue</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"> *   is currently in netmap mode. Netmap will not intercept host stack mbufs</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment"> *   designated to NIC queues that are not in netmap mode. As a consequence,</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"> *   registering a netmap port with netmap:foo^ is not enough to intercept</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"> *   mbufs in the RX host ring; the netmap port should be registered with</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"> *   netmap:foo*, or another registration should be done to open at least a</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment"> *   NIC TX queue in netmap mode.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment"> * + Netmap is not currently able to deal with intercepted trasmit mbufs which</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"> *   require offloadings like TSO, UFO, checksumming offloadings, etc. It is</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"> *   responsibility of the user to disable those offloadings (e.g. using</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"> *   ifconfig on FreeBSD or ethtool -K on Linux) for an interface that is being</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment"> *   used in netmap mode. If the offloadings are not disabled, GSO and/or</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment"> *   unchecksummed packets may be dropped immediately or end up in the host RX</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"> *   ring, and will be dropped as soon as the packet reaches another netmap</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment"> *   adapter.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment"> * struct netmap_slot is a buffer descriptor</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="structnetmap__slot.html">  165</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structnetmap__slot.html">netmap_slot</a> {</div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="structnetmap__slot.html#a53b5fc7beb0712b9c41f344177894ade">  166</a></span>&#160;    uint32_t <a class="code" href="structnetmap__slot.html#a53b5fc7beb0712b9c41f344177894ade">buf_idx</a>;   <span class="comment">/* buffer index */</span></div>
<div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="structnetmap__slot.html#a504f80f1df944631d75a35c67c3b747f">  167</a></span>&#160;    uint16_t <a class="code" href="structnetmap__slot.html#a504f80f1df944631d75a35c67c3b747f">len</a>;       <span class="comment">/* length for this slot */</span></div>
<div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="structnetmap__slot.html#a55cf5ec447f34d0cab46f065728a5d93">  168</a></span>&#160;    uint16_t <a class="code" href="structnetmap__slot.html#a55cf5ec447f34d0cab46f065728a5d93">flags</a>;     <span class="comment">/* buf changed, etc. */</span></div>
<div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="structnetmap__slot.html#ad179b4b3689715000c364d00abdb05b4">  169</a></span>&#160;    uint64_t <a class="code" href="structnetmap__slot.html#ad179b4b3689715000c364d00abdb05b4">ptr</a>;       <span class="comment">/* pointer for indirect buffers */</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;};</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment"> * The following flags control how the slot is used</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="netmap_8h.html#a7dcf0e4b0c59bec083d6bcc38b4915f3">  176</a></span>&#160;<span class="preprocessor">#define NS_BUF_CHANGED  0x0001  </span><span class="comment">/* buf_idx changed */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">     * must be set whenever buf_idx is changed (as it might be</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">     * necessary to recompute the physical address and mapping)</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">     * It is also set by the kernel whenever the buf_idx is</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">     * changed internally (e.g., by pipes). Applications may</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">     * use this information to know when they can reuse the</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">     * contents of previously prepared buffers.</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="netmap_8h.html#a8bf3e16b1288e0ef6f0ba5747b5e5294">  187</a></span>&#160;<span class="preprocessor">#define NS_REPORT   0x0002  </span><span class="comment">/* ask the hardware to report results */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">     * Request notification when slot is used by the hardware.</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">     * Normally transmit completions are handled lazily and</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">     * may be unreported. This flag lets us know when a slot</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">     * has been sent (e.g. to terminate the sender).</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="netmap_8h.html#a0042e995a101c870db60f281d58da40f">  195</a></span>&#160;<span class="preprocessor">#define NS_FORWARD  0x0004  </span><span class="comment">/* pass packet &#39;forward&#39; */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">     * (Only for physical ports, rx rings with NR_FORWARD set).</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">     * Slot released to the kernel (i.e. before ring-&gt;head) with</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">     * this flag set are passed to the peer ring (host/NIC),</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">     * thus restoring the host-NIC connection for these slots.</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">     * This supports efficient traffic monitoring or firewalling.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno"><a class="line" href="netmap_8h.html#a61274a9df81442475999b6b5ef33cb6d">  204</a></span>&#160;<span class="preprocessor">#define NS_NO_LEARN 0x0008  </span><span class="comment">/* disable bridge learning */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">     * On a VALE switch, do not &#39;learn&#39; the source port for</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">     * this buffer.</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="netmap_8h.html#a24868b1fb61cfcc67e3385c8cd0d26f0">  210</a></span>&#160;<span class="preprocessor">#define NS_INDIRECT 0x0010  </span><span class="comment">/* userspace buffer */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">     * (VALE tx rings only) data is in a userspace buffer,</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">     * whose address is in the &#39;ptr&#39; field in the slot.</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="netmap_8h.html#a525b1c6a32ed441329ee0888e69200ec">  216</a></span>&#160;<span class="preprocessor">#define NS_MOREFRAG 0x0020  </span><span class="comment">/* packet has more fragments */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">     * (VALE ports, ptnetmap ports and some NIC ports, e.g.</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">         * ixgbe and i40e on Linux)</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">     * Set on all but the last slot of a multi-segment packet.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">     * The &#39;len&#39; field refers to the individual fragment.</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="netmap_8h.html#a88aaf951c6911fd809a305a7e0e930b1">  224</a></span>&#160;<span class="preprocessor">#define NS_PORT_SHIFT   8</span></div>
<div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="netmap_8h.html#a6453b2031da74dc33b5b00ad318675a7">  225</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NS_PORT_MASK    (0xff &lt;&lt; NS_PORT_SHIFT)</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">     * The high 8 bits of the flag, if not zero, indicate the</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">     * destination port for the VALE switch, overriding</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">     * the lookup table.</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="netmap_8h.html#a87286a29067b634a9748ba110525ad58">  232</a></span>&#160;<span class="preprocessor">#define NS_RFRAGS(_slot)    ( ((_slot)-&gt;flags &gt;&gt; 8) &amp; 0xff)</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">     * (VALE rx rings only) the high 8 bits</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">     *  are the number of fragments.</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment"> * struct netmap_ring</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"> * Netmap representation of a TX or RX ring (also known as &quot;queue&quot;).</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment"> * This is a queue implemented as a fixed-size circular array.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"> * At the software level the important fields are: head, cur, tail.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment"> * In TX rings:</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment"> *  head    first slot available for transmission.</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment"> *  cur wakeup point. select() and poll() will unblock</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"> *      when &#39;tail&#39; moves past &#39;cur&#39;</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"> *  tail    (readonly) first slot reserved to the kernel</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment"> *  [head .. tail-1] can be used for new packets to send;</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment"> *  &#39;head&#39; and &#39;cur&#39; must be incremented as slots are filled</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment"> *      with new packets to be sent;</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment"> *  &#39;cur&#39; can be moved further ahead if we need more space</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment"> *  for new transmissions. XXX todo (2014-03-12)</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment"> * In RX rings:</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"> *  head    first valid received packet</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment"> *  cur wakeup point. select() and poll() will unblock</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"> *      when &#39;tail&#39; moves past &#39;cur&#39;</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment"> *  tail    (readonly) first slot reserved to the kernel</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment"> *  [head .. tail-1] contain received packets;</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment"> *  &#39;head&#39; and &#39;cur&#39; must be incremented as slots are consumed</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment"> *      and can be returned to the kernel;</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment"> *  &#39;cur&#39; can be moved further ahead if we want to wait for</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"> *      new packets without returning the previous ones.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment"> * DATA OWNERSHIP/LOCKING:</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment"> *  The netmap_ring, and all slots and buffers in the range</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment"> *  [head .. tail-1] are owned by the user program;</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment"> *  the kernel only accesses them during a netmap system call</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"> *  and in the user thread context.</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"> *  Other slots and buffers are reserved for use by the kernel</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="structnetmap__ring.html">  280</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structnetmap__ring.html">netmap_ring</a> {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">     * buf_ofs is meant to be used through macros.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">     * It contains the offset of the buffer region from this</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">     * descriptor.</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00286"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#a7ffcfff1be1ca50a663914184b7faecf">  286</a></span>&#160;    <span class="keyword">const</span> int64_t   <a class="code" href="structnetmap__ring.html#a7ffcfff1be1ca50a663914184b7faecf">buf_ofs</a>;</div>
<div class="line"><a name="l00287"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#a37102602c060ee425a89df961b39e208">  287</a></span>&#160;    <span class="keyword">const</span> uint32_t  <a class="code" href="structnetmap__ring.html#a37102602c060ee425a89df961b39e208">num_slots</a>;  <span class="comment">/* number of slots in the ring. */</span></div>
<div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#a7225b6ef5a79eb6e8df13fbe986543eb">  288</a></span>&#160;    <span class="keyword">const</span> uint32_t  <a class="code" href="structnetmap__ring.html#a7225b6ef5a79eb6e8df13fbe986543eb">nr_buf_size</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#a9638eb5de920d539aa9a6a518e4d4827">  289</a></span>&#160;    <span class="keyword">const</span> uint16_t  <a class="code" href="structnetmap__ring.html#a9638eb5de920d539aa9a6a518e4d4827">ringid</a>;</div>
<div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#a56efa3d3188e04e44733858f9b0cf6a1">  290</a></span>&#160;    <span class="keyword">const</span> uint16_t  <a class="code" href="structnetmap__ring.html#a56efa3d3188e04e44733858f9b0cf6a1">dir</a>;        <span class="comment">/* 0: tx, 1: rx */</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#abe2efe17dacd91af126a1d4a63225424">  292</a></span>&#160;    uint32_t        <a class="code" href="structnetmap__ring.html#abe2efe17dacd91af126a1d4a63225424">head</a>;       <span class="comment">/* (u) first user slot */</span></div>
<div class="line"><a name="l00293"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#a116a2a487bf4b24a2f98b9e853139105">  293</a></span>&#160;    uint32_t        <a class="code" href="structnetmap__ring.html#a116a2a487bf4b24a2f98b9e853139105">cur</a>;        <span class="comment">/* (u) wakeup point */</span></div>
<div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#aaf077ab220816b275a48c154570ab1ee">  294</a></span>&#160;    uint32_t    <a class="code" href="structnetmap__ring.html#aaf077ab220816b275a48c154570ab1ee">tail</a>;       <span class="comment">/* (k) first kernel slot */</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div>
<div class="line"><a name="l00296"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#a2d73ed8aacb735a74587c6d59bfa521f">  296</a></span>&#160;    uint32_t    <a class="code" href="structnetmap__ring.html#a2d73ed8aacb735a74587c6d59bfa521f">flags</a>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#a92b1183e066bcd2fc65a16b8f5cd57ae">  298</a></span>&#160;    <span class="keyword">struct </span>timeval  <a class="code" href="structnetmap__ring.html#a92b1183e066bcd2fc65a16b8f5cd57ae">ts</a>;     <span class="comment">/* (k) time of last *sync() */</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">/* opaque room for a mutex or similar object */</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor">#if !defined(_WIN32) || defined(__CYGWIN__)</span></div>
<div class="line"><a name="l00302"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#adfb2ffe7f091af3aa8d369e80de91691">  302</a></span>&#160;<span class="preprocessor"></span>    uint8_t __attribute__((__aligned__(<a class="code" href="netmap_8h.html#a3b1049947637ce44a5dbc247e570302c">NM_CACHE_ALIGN</a>))) <a class="code" href="structnetmap__ring.html#adfb2ffe7f091af3aa8d369e80de91691">sem</a>[128];</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor"></span>    uint8_t __declspec(align(<a class="code" href="netmap_8h.html#a3b1049947637ce44a5dbc247e570302c">NM_CACHE_ALIGN</a>)) sem[128];</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">/* the slots follow. This struct has variable size */</span></div>
<div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="structnetmap__ring.html#ac11c6137efc7fc88ff2ff8ca413c9035">  308</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="structnetmap__slot.html">netmap_slot</a> <a class="code" href="structnetmap__ring.html#ac11c6137efc7fc88ff2ff8ca413c9035">slot</a>[0]; <span class="comment">/* array of slots. */</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;};</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment"> * RING FLAGS</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00315"></a><span class="lineno"><a class="line" href="netmap_8h.html#abb2d52203fd2b9f628db7a2f4ecb6344">  315</a></span>&#160;<span class="preprocessor">#define NR_TIMESTAMP    0x0002      </span><span class="comment">/* set timestamp on *sync() */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">     * updates the &#39;ts&#39; field on each netmap syscall. This saves</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">     * saves a separate gettimeofday(), and is not much worse than</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">     * software timestamps generated in the interrupt handler.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00322"></a><span class="lineno"><a class="line" href="netmap_8h.html#aa83b675a8b92529ee8a6e0c8e5785ca7">  322</a></span>&#160;<span class="preprocessor">#define NR_FORWARD  0x0004      </span><span class="comment">/* enable NS_FORWARD for ring */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="preprocessor"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">     * Enables the NS_FORWARD slot flag for the ring.</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment"> * Netmap representation of an interface and its queue(s).</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment"> * This is initialized by the kernel when binding a file</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"> * descriptor to a port, and should be considered as readonly</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"> * by user programs. The kernel never uses it.</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment"> * There is one netmap_if for each file descriptor on which we want</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"> * to select/poll.</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"> * select/poll operates on one or all pairs depending on the value of</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"> * nmr_queueid passed on the ioctl.</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="structnetmap__if.html">  339</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structnetmap__if.html">netmap_if</a> {</div>
<div class="line"><a name="l00340"></a><span class="lineno"><a class="line" href="structnetmap__if.html#a6e2f3b7e18942a7d4de5763d220ce9b2">  340</a></span>&#160;    <span class="keywordtype">char</span>        <a class="code" href="structnetmap__if.html#a6e2f3b7e18942a7d4de5763d220ce9b2">ni_name</a>[IFNAMSIZ]; <span class="comment">/* name of the interface. */</span></div>
<div class="line"><a name="l00341"></a><span class="lineno"><a class="line" href="structnetmap__if.html#a2faaffd8c1892bd50a6aaf6f2780240f">  341</a></span>&#160;    <span class="keyword">const</span> uint32_t  <a class="code" href="structnetmap__if.html#a2faaffd8c1892bd50a6aaf6f2780240f">ni_version</a>; <span class="comment">/* API version, currently unused */</span></div>
<div class="line"><a name="l00342"></a><span class="lineno"><a class="line" href="structnetmap__if.html#ad13b44724d6ebc70cbe733a63c96039f">  342</a></span>&#160;    <span class="keyword">const</span> uint32_t  <a class="code" href="structnetmap__if.html#ad13b44724d6ebc70cbe733a63c96039f">ni_flags</a>;   <span class="comment">/* properties */</span></div>
<div class="line"><a name="l00343"></a><span class="lineno"><a class="line" href="netmap_8h.html#a0fe9c019737f9e63abcc99b327a001f7">  343</a></span>&#160;<span class="preprocessor">#define NI_PRIV_MEM 0x1     </span><span class="comment">/* private memory region */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">     * The number of packet rings available in netmap mode.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">     * Physical NICs can have different numbers of tx and rx rings.</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">     * Physical NICs also have a &#39;host&#39; ring pair.</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">     * Additionally, clients can request additional ring pairs to</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">     * be used for internal communication.</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00352"></a><span class="lineno"><a class="line" href="structnetmap__if.html#ab8b14e631b50fb480377725d2a5281c4">  352</a></span>&#160;    <span class="keyword">const</span> uint32_t  <a class="code" href="structnetmap__if.html#ab8b14e631b50fb480377725d2a5281c4">ni_tx_rings</a>;    <span class="comment">/* number of HW tx rings */</span></div>
<div class="line"><a name="l00353"></a><span class="lineno"><a class="line" href="structnetmap__if.html#ad414fbdb730bbd001ae8ef3af8440e8f">  353</a></span>&#160;    <span class="keyword">const</span> uint32_t  <a class="code" href="structnetmap__if.html#ad414fbdb730bbd001ae8ef3af8440e8f">ni_rx_rings</a>;    <span class="comment">/* number of HW rx rings */</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div>
<div class="line"><a name="l00355"></a><span class="lineno"><a class="line" href="structnetmap__if.html#ae76d2e39d643cb6361eb1bbf8365c1b3">  355</a></span>&#160;    uint32_t    <a class="code" href="structnetmap__if.html#ae76d2e39d643cb6361eb1bbf8365c1b3">ni_bufs_head</a>;   <span class="comment">/* head index for extra bufs */</span></div>
<div class="line"><a name="l00356"></a><span class="lineno"><a class="line" href="structnetmap__if.html#a93d2c43fb0e6b532b3139dca3a27395d">  356</a></span>&#160;    uint32_t    <a class="code" href="structnetmap__if.html#a93d2c43fb0e6b532b3139dca3a27395d">ni_spare1</a>[5];</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">     * The following array contains the offset of each netmap ring</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">     * from this structure, in the following order:</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">     * NIC tx rings (ni_tx_rings); host tx ring (1); extra tx rings;</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">     * NIC rx rings (ni_rx_rings); host tx ring (1); extra rx rings.</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">     * The area is filled up by the kernel on NIOCREGIF,</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">     * and then only read by userspace code.</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00366"></a><span class="lineno"><a class="line" href="structnetmap__if.html#a1dfdb80b4e21abc21e01a07b07f37cca">  366</a></span>&#160;    <span class="keyword">const</span> ssize_t   <a class="code" href="structnetmap__if.html#a1dfdb80b4e21abc21e01a07b07f37cca">ring_ofs</a>[0];</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;};</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="preprocessor">#ifndef NIOCREGIF</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="preprocessor"></span><span class="comment">/*</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"> * ioctl names and related fields</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment"> * NIOCTXSYNC, NIOCRXSYNC synchronize tx or rx queues,</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment"> *  whose identity is set in NIOCREGIF through nr_ringid.</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment"> *  These are non blocking and take no argument.</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment"> * NIOCGINFO takes a struct ifreq, the interface name is the input,</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment"> *  the outputs are number of queues and number of descriptor</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment"> *  for each queue (useful to set number of threads etc.).</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"> *  The info returned is only advisory and may change before</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment"> *  the interface is bound to a file descriptor.</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"> * NIOCREGIF takes an interface name within a struct nmre,</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"> *  and activates netmap mode on the interface (if possible).</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"> * The argument to NIOCGINFO/NIOCREGIF overlays struct ifreq so we</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment"> * can pass it down to other NIC-related ioctls.</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment"> * The actual argument (struct nmreq) has a number of options to request</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment"> * different functions.</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment"> * The following are used in NIOCREGIF when nr_cmd == 0:</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment"> * nr_name  (in)</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment"> *  The name of the port (em0, valeXXX:YYY, etc.)</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment"> *  limited to IFNAMSIZ for backward compatibility.</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment"> * nr_version   (in/out)</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment"> *  Must match NETMAP_API as used in the kernel, error otherwise.</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment"> *  Always returns the desired value on output.</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment"> * nr_tx_slots, nr_tx_slots, nr_tx_rings, nr_rx_rings (in/out)</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment"> *  On input, non-zero values may be used to reconfigure the port</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment"> *  according to the requested values, but this is not guaranteed.</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment"> *  On output the actual values in use are reported.</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment"> * nr_ringid (in)</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment"> *  Indicates how rings should be bound to the file descriptors.</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment"> *  If nr_flags != 0, then the low bits (in NETMAP_RING_MASK)</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment"> *  are used to indicate the ring number, and nr_flags specifies</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment"> *  the actual rings to bind. NETMAP_NO_TX_POLL is unaffected.</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"> *  NOTE: THE FOLLOWING (nr_flags == 0) IS DEPRECATED:</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment"> *  If nr_flags == 0, NETMAP_HW_RING and NETMAP_SW_RING control</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment"> *  the binding as follows:</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment"> *  0 (default)         binds all physical rings</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment"> *  NETMAP_HW_RING | ring number    binds a single ring pair</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment"> *  NETMAP_SW_RING          binds only the host tx/rx rings</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment"> *  NETMAP_NO_TX_POLL can be OR-ed to make select()/poll() push</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment"> *      packets on tx rings only if POLLOUT is set.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment"> *      The default is to push any pending packet.</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment"> *  NETMAP_DO_RX_POLL can be OR-ed to make select()/poll() release</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment"> *      packets on rx rings also when POLLIN is NOT set.</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment"> *      The default is to touch the rx ring only with POLLIN.</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"> *      Note that this is the opposite of TX because it</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment"> *      reflects the common usage.</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"> *  NOTE: NETMAP_PRIV_MEM IS DEPRECATED, use nr_arg2 instead.</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"> *  NETMAP_PRIV_MEM is set on return for ports that do not use</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"> *      the global memory allocator.</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"> *      This information is not significant and applications</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment"> *      should look at the region id in nr_arg2</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"> * nr_flags is the recommended mode to indicate which rings should</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"> *      be bound to a file descriptor. Values are NR_REG_*</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment"> * nr_arg1 (in) The number of extra rings to be reserved.</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment"> *      Especially when allocating a VALE port the system only</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"> *      allocates the amount of memory needed for the port.</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment"> *      If more shared memory rings are desired (e.g. for pipes),</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"> *      the first invocation for the same basename/allocator</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment"> *      should specify a suitable number. Memory cannot be</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment"> *      extended after the first allocation without closing</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment"> *      all ports on the same region.</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment"> * nr_arg2 (in/out) The identity of the memory region used.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment"> *      On input, 0 means the system decides autonomously,</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment"> *      other values may try to select a specific region.</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"> *      On return the actual value is reported.</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment"> *      Region &#39;1&#39; is the global allocator, normally shared</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment"> *      by all interfaces. Other values are private regions.</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment"> *      If two ports the same region zero-copy is possible.</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment"> * nr_arg3 (in/out) number of extra buffers to be allocated.</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment"> * nr_cmd (in)  if non-zero indicates a special command:</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment"> *  NETMAP_BDG_ATTACH    and nr_name = vale*:ifname</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment"> *      attaches the NIC to the switch; nr_ringid specifies</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"> *      which rings to use. Used by vale-ctl -a ...</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment"> *      nr_arg1 = NETMAP_BDG_HOST also attaches the host port</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment"> *      as in vale-ctl -h ...</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment"> *  NETMAP_BDG_DETACH   and nr_name = vale*:ifname</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment"> *      disconnects a previously attached NIC.</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment"> *      Used by vale-ctl -d ...</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment"> *  NETMAP_BDG_LIST</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment"> *      list the configuration of VALE switches.</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment"> *  NETMAP_BDG_VNET_HDR</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment"> *      Set the virtio-net header length used by the client</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment"> *      of a VALE switch port.</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment"> *  NETMAP_BDG_NEWIF</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment"> *      create a persistent VALE port with name nr_name.</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment"> *      Used by vale-ctl -n ...</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment"> *  NETMAP_BDG_DELIF</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment"> *      delete a persistent VALE port. Used by vale-ctl -d ...</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment"> * nr_arg1, nr_arg2, nr_arg3  (in/out)      command specific</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment"> * struct nmreq overlays a struct ifreq (just the name)</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00495"></a><span class="lineno"><a class="line" href="structnmreq.html">  495</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structnmreq.html">nmreq</a> {</div>
<div class="line"><a name="l00496"></a><span class="lineno"><a class="line" href="structnmreq.html#a3ec7cdc9a7f3bb9103f2088a30c5408d">  496</a></span>&#160;    <span class="keywordtype">char</span>        <a class="code" href="structnmreq.html#a3ec7cdc9a7f3bb9103f2088a30c5408d">nr_name</a>[IFNAMSIZ];</div>
<div class="line"><a name="l00497"></a><span class="lineno"><a class="line" href="structnmreq.html#ae12f9325eefa6832cd79cb7fd9a600df">  497</a></span>&#160;    uint32_t    <a class="code" href="structnmreq.html#ae12f9325eefa6832cd79cb7fd9a600df">nr_version</a>; <span class="comment">/* API version */</span></div>
<div class="line"><a name="l00498"></a><span class="lineno"><a class="line" href="structnmreq.html#aeac6e7c4301879310ec3d580c9e81105">  498</a></span>&#160;    uint32_t    <a class="code" href="structnmreq.html#aeac6e7c4301879310ec3d580c9e81105">nr_offset</a>;  <span class="comment">/* nifp offset in the shared region */</span></div>
<div class="line"><a name="l00499"></a><span class="lineno"><a class="line" href="structnmreq.html#ab90704691a1ec4b48c23cde016bd2dc1">  499</a></span>&#160;    uint32_t    <a class="code" href="structnmreq.html#ab90704691a1ec4b48c23cde016bd2dc1">nr_memsize</a>; <span class="comment">/* size of the shared region */</span></div>
<div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="structnmreq.html#a471cf0759451e8f3e3ca91a35a0e5c2c">  500</a></span>&#160;    uint32_t    <a class="code" href="structnmreq.html#a471cf0759451e8f3e3ca91a35a0e5c2c">nr_tx_slots</a>;    <span class="comment">/* slots in tx rings */</span></div>
<div class="line"><a name="l00501"></a><span class="lineno"><a class="line" href="structnmreq.html#a164625aa23e5ff67e48a81e0340e82ae">  501</a></span>&#160;    uint32_t    <a class="code" href="structnmreq.html#a164625aa23e5ff67e48a81e0340e82ae">nr_rx_slots</a>;    <span class="comment">/* slots in rx rings */</span></div>
<div class="line"><a name="l00502"></a><span class="lineno"><a class="line" href="structnmreq.html#ac8bd987253a1cac2cb0c9df35691d17c">  502</a></span>&#160;    uint16_t    <a class="code" href="structnmreq.html#ac8bd987253a1cac2cb0c9df35691d17c">nr_tx_rings</a>;    <span class="comment">/* number of tx rings */</span></div>
<div class="line"><a name="l00503"></a><span class="lineno"><a class="line" href="structnmreq.html#ab69f153468b56318beceed7573061520">  503</a></span>&#160;    uint16_t    <a class="code" href="structnmreq.html#ab69f153468b56318beceed7573061520">nr_rx_rings</a>;    <span class="comment">/* number of rx rings */</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno"><a class="line" href="structnmreq.html#ae722dbbdbcb2d4a4a63c19809d09b065">  505</a></span>&#160;    uint16_t    <a class="code" href="structnmreq.html#ae722dbbdbcb2d4a4a63c19809d09b065">nr_ringid</a>;  <span class="comment">/* ring(s) we care about */</span></div>
<div class="line"><a name="l00506"></a><span class="lineno"><a class="line" href="netmap_8h.html#ae0ae3657e22f5fbe43b4b1948db8c1d7">  506</a></span>&#160;<span class="preprocessor">#define NETMAP_HW_RING      0x4000  </span><span class="comment">/* single NIC ring pair */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00507"></a><span class="lineno"><a class="line" href="netmap_8h.html#a6562f84ccaa7b9a2bd0e64dbc1115f3e">  507</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_SW_RING      0x2000  </span><span class="comment">/* only host ring pair */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00509"></a><span class="lineno"><a class="line" href="netmap_8h.html#a85e0f7034b09b3650503e850a592a508">  509</a></span>&#160;<span class="preprocessor">#define NETMAP_RING_MASK    0x0fff  </span><span class="comment">/* the ring number */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="netmap_8h.html#a99b1adbf0022987ca826ba4358c55207">  511</a></span>&#160;<span class="preprocessor">#define NETMAP_NO_TX_POLL   0x1000  </span><span class="comment">/* no automatic txsync on poll */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00513"></a><span class="lineno"><a class="line" href="netmap_8h.html#a29a212086e666457b180b5097f463155">  513</a></span>&#160;<span class="preprocessor">#define NETMAP_DO_RX_POLL   0x8000  </span><span class="comment">/* DO automatic rxsync on poll */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00515"></a><span class="lineno"><a class="line" href="structnmreq.html#a5a45993e368a473d90286807710bc69f">  515</a></span>&#160;    uint16_t    <a class="code" href="structnmreq.html#a5a45993e368a473d90286807710bc69f">nr_cmd</a>;</div>
<div class="line"><a name="l00516"></a><span class="lineno"><a class="line" href="netmap_8h.html#aaa02b7ff5c6853d340ff200c6d2a9648">  516</a></span>&#160;<span class="preprocessor">#define NETMAP_BDG_ATTACH   1   </span><span class="comment">/* attach the NIC */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00517"></a><span class="lineno"><a class="line" href="netmap_8h.html#ae5185c1bf63ef5df84635282f32125af">  517</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_BDG_DETACH   2   </span><span class="comment">/* detach the NIC */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00518"></a><span class="lineno"><a class="line" href="netmap_8h.html#ae04bd7ea57badf7db7cd56662c990ea9">  518</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_BDG_REGOPS   3   </span><span class="comment">/* register bridge callbacks */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00519"></a><span class="lineno"><a class="line" href="netmap_8h.html#a04dc6c6d8d1063aab9ac441677b0e613">  519</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_BDG_LIST     4   </span><span class="comment">/* get bridge&#39;s info */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00520"></a><span class="lineno"><a class="line" href="netmap_8h.html#add32ba800de0fc2df028d40e4c0f2e21">  520</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_BDG_VNET_HDR     5       </span><span class="comment">/* set the port virtio-net-hdr length */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00521"></a><span class="lineno"><a class="line" href="netmap_8h.html#a19ed4a228a83ae69f4257c708f9bd72d">  521</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_BDG_OFFSET   NETMAP_BDG_VNET_HDR </span><span class="comment">/* deprecated alias */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00522"></a><span class="lineno"><a class="line" href="netmap_8h.html#a67ffa6e36b557af1ae4c87377682ec51">  522</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_BDG_NEWIF    6   </span><span class="comment">/* create a virtual port */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00523"></a><span class="lineno"><a class="line" href="netmap_8h.html#aae6c2f3e1676565ad8c976a2e4bb5199">  523</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_BDG_DELIF    7   </span><span class="comment">/* destroy a virtual port */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00524"></a><span class="lineno"><a class="line" href="netmap_8h.html#a5ab02eb30033cda2351451c84a9df8f0">  524</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_PT_HOST_CREATE   8   </span><span class="comment">/* create ptnetmap kthreads */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00525"></a><span class="lineno"><a class="line" href="netmap_8h.html#ac5377cd238a2b8df6850e02205c8009c">  525</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_PT_HOST_DELETE   9   </span><span class="comment">/* delete ptnetmap kthreads */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00526"></a><span class="lineno"><a class="line" href="netmap_8h.html#a7bfe1b1534b8d1323a8b0e26d8b9330e">  526</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_BDG_POLLING_ON   10  </span><span class="comment">/* delete polling kthread */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00527"></a><span class="lineno"><a class="line" href="netmap_8h.html#aa364b6b66e2fe54d250d399c9746f088">  527</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_BDG_POLLING_OFF  11  </span><span class="comment">/* delete polling kthread */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00528"></a><span class="lineno"><a class="line" href="netmap_8h.html#ab9695838fe1825e1247417f0930bc7b6">  528</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_VNET_HDR_GET 12      </span><span class="comment">/* get the port virtio-net-hdr length */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="netmap_8h.html#a29a6e6810c5253ad4b938b206931c5a9">  529</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_POOLS_INFO_GET   13  </span><span class="comment">/* get memory allocator pools info */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00530"></a><span class="lineno"><a class="line" href="structnmreq.html#ad5ec54607ccfd57982c1d6d3285b4fba">  530</a></span>&#160;<span class="preprocessor"></span>    uint16_t    <a class="code" href="structnmreq.html#ad5ec54607ccfd57982c1d6d3285b4fba">nr_arg1</a>;    <span class="comment">/* reserve extra rings in NIOCREGIF */</span></div>
<div class="line"><a name="l00531"></a><span class="lineno"><a class="line" href="netmap_8h.html#ab321ca0ffb14f777bd58f347a38e49ab">  531</a></span>&#160;<span class="preprocessor">#define NETMAP_BDG_HOST     1   </span><span class="comment">/* attach the host stack on ATTACH */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00533"></a><span class="lineno"><a class="line" href="structnmreq.html#a8ea266b04964d17e204b15cd25571083">  533</a></span>&#160;    uint16_t    <a class="code" href="structnmreq.html#a8ea266b04964d17e204b15cd25571083">nr_arg2</a>;</div>
<div class="line"><a name="l00534"></a><span class="lineno"><a class="line" href="structnmreq.html#adbf0933ed01dfb94e36dabc9c42e82fb">  534</a></span>&#160;    uint32_t    <a class="code" href="structnmreq.html#adbf0933ed01dfb94e36dabc9c42e82fb">nr_arg3</a>;    <span class="comment">/* req. extra buffers in NIOCREGIF */</span></div>
<div class="line"><a name="l00535"></a><span class="lineno"><a class="line" href="structnmreq.html#a5c58284511ee8b4803c25b2b319deec3">  535</a></span>&#160;    uint32_t    <a class="code" href="structnmreq.html#a5c58284511ee8b4803c25b2b319deec3">nr_flags</a>;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="comment">/* various modes, extends nr_ringid */</span></div>
<div class="line"><a name="l00537"></a><span class="lineno"><a class="line" href="structnmreq.html#acdef73623694120dcda0f6805d1ec30d">  537</a></span>&#160;    uint32_t    <a class="code" href="structnmreq.html#acdef73623694120dcda0f6805d1ec30d">spare2</a>[1];</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;};</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno"><a class="line" href="netmap_8h.html#a2a1a22635528abc06b02764d8fb4b139">  540</a></span>&#160;<span class="preprocessor">#define NR_REG_MASK     0xf </span><span class="comment">/* values for nr_flags */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00541"></a><span class="lineno"><a class="line" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba3b454164cdcee73c3cb5df91569e2d5b">  541</a></span>&#160;<span class="preprocessor"></span><span class="keyword">enum</span> {  <a class="code" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba3b454164cdcee73c3cb5df91569e2d5b">NR_REG_DEFAULT</a>  = 0,    <span class="comment">/* backward compat, should not be used. */</span></div>
<div class="line"><a name="l00542"></a><span class="lineno"><a class="line" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba6eefc97d6fcebc35fc66038172acf8d4">  542</a></span>&#160;    <a class="code" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba6eefc97d6fcebc35fc66038172acf8d4">NR_REG_ALL_NIC</a>  = 1,</div>
<div class="line"><a name="l00543"></a><span class="lineno"><a class="line" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55bac8cca0b6844df0e5417719d9228aa5c5">  543</a></span>&#160;    <a class="code" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55bac8cca0b6844df0e5417719d9228aa5c5">NR_REG_SW</a>   = 2,</div>
<div class="line"><a name="l00544"></a><span class="lineno"><a class="line" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba0824e0950ee08ae8fc674bc9ddaa3a34">  544</a></span>&#160;    <a class="code" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba0824e0950ee08ae8fc674bc9ddaa3a34">NR_REG_NIC_SW</a>   = 3,</div>
<div class="line"><a name="l00545"></a><span class="lineno"><a class="line" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba62ea9c598020ddaa6be65cd5ba6b6578">  545</a></span>&#160;    <a class="code" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba62ea9c598020ddaa6be65cd5ba6b6578">NR_REG_ONE_NIC</a>  = 4,</div>
<div class="line"><a name="l00546"></a><span class="lineno"><a class="line" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55bade2109b5bb9eb5377d13a3857397494f">  546</a></span>&#160;    <a class="code" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55bade2109b5bb9eb5377d13a3857397494f">NR_REG_PIPE_MASTER</a> = 5,</div>
<div class="line"><a name="l00547"></a><span class="lineno"><a class="line" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55baacdc70a35aa6dffd208c6e178e6df7d7">  547</a></span>&#160;    <a class="code" href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55baacdc70a35aa6dffd208c6e178e6df7d7">NR_REG_PIPE_SLAVE</a> = 6,</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;};</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">/* monitor uses the NR_REG to select the rings to monitor */</span></div>
<div class="line"><a name="l00550"></a><span class="lineno"><a class="line" href="netmap_8h.html#ac8e2f2ee3ab8e6deaa51c9bdad2d485a">  550</a></span>&#160;<span class="preprocessor">#define NR_MONITOR_TX   0x100</span></div>
<div class="line"><a name="l00551"></a><span class="lineno"><a class="line" href="netmap_8h.html#a6ffc08903814c7ba494afe65196adad3">  551</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NR_MONITOR_RX   0x200</span></div>
<div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="netmap_8h.html#acee1645a0ec7cb08e8799a8700037129">  552</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NR_ZCOPY_MON    0x400</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="preprocessor"></span><span class="comment">/* request exclusive access to the selected rings */</span></div>
<div class="line"><a name="l00554"></a><span class="lineno"><a class="line" href="netmap_8h.html#a12cdae5225526c92877e45c4e778664d">  554</a></span>&#160;<span class="preprocessor">#define NR_EXCLUSIVE    0x800</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="preprocessor"></span><span class="comment">/* request ptnetmap host support */</span></div>
<div class="line"><a name="l00556"></a><span class="lineno"><a class="line" href="netmap_8h.html#aa270c718ee2b54a8accfef7ec93d70af">  556</a></span>&#160;<span class="preprocessor">#define NR_PASSTHROUGH_HOST NR_PTNETMAP_HOST </span><span class="comment">/* deprecated */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00557"></a><span class="lineno"><a class="line" href="netmap_8h.html#af4e5498aa386e4f034c0423aa75992b6">  557</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NR_PTNETMAP_HOST    0x1000</span></div>
<div class="line"><a name="l00558"></a><span class="lineno"><a class="line" href="netmap_8h.html#a6cc9591ed7e49d8bb8b3cd463e2bcdfd">  558</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NR_RX_RINGS_ONLY    0x2000</span></div>
<div class="line"><a name="l00559"></a><span class="lineno"><a class="line" href="netmap_8h.html#ade9edf79f46abd852cb55186fe219667">  559</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NR_TX_RINGS_ONLY    0x4000</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="preprocessor"></span><span class="comment">/* Applications set this flag if they are able to deal with virtio-net headers,</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment"> * that is send/receive frames that start with a virtio-net header.</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment"> * If not set, NIOCREGIF will fail with netmap ports that require applications</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment"> * to use those headers. If the flag is set, the application can use the</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment"> * NETMAP_VNET_HDR_GET command to figure out the header length. */</span></div>
<div class="line"><a name="l00565"></a><span class="lineno"><a class="line" href="netmap_8h.html#a9f9c84bf48293c4a8a78e6f523f99c08">  565</a></span>&#160;<span class="preprocessor">#define NR_ACCEPT_VNET_HDR  0x8000</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00567"></a><span class="lineno"><a class="line" href="netmap_8h.html#a239ceb32c04615908015cfc97185a64d">  567</a></span>&#160;<span class="preprocessor">#define NM_BDG_NAME     &quot;vale&quot;  </span><span class="comment">/* prefix for bridge port name */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="preprocessor"></span><span class="comment">/*</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment"> * Windows does not have _IOWR(). _IO(), _IOW() and _IOR() are defined</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment"> * in ws2def.h but not sure if they are in the form we need.</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment"> * We therefore redefine them in a convenient way to use for DeviceIoControl</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment"> * signatures.</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="preprocessor">#undef _IO  // ws2def.h</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define _WIN_NM_IOCTL_TYPE 40000</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define _IO(_c, _n) CTL_CODE(_WIN_NM_IOCTL_TYPE, ((_n) + 0x800) , \</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="preprocessor">        METHOD_BUFFERED, FILE_ANY_ACCESS  )</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define _IO_direct(_c, _n)  CTL_CODE(_WIN_NM_IOCTL_TYPE, ((_n) + 0x800) , \</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="preprocessor">        METHOD_OUT_DIRECT, FILE_ANY_ACCESS  )</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="preprocessor">#define _IOWR(_c, _n, _s)   _IO(_c, _n)</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">/* We havesome internal sysctl in addition to the externally visible ones */</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="preprocessor">#define NETMAP_MMAP _IO_direct(&#39;i&#39;, 160)    // note METHOD_OUT_DIRECT</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_POLL _IO(&#39;i&#39;, 162)</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">/* and also two setsockopt for sysctl emulation */</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="preprocessor">#define NETMAP_SETSOCKOPT _IO(&#39;i&#39;, 140)</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_GETSOCKOPT _IO(&#39;i&#39;, 141)</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">//These linknames are for the Netmap Core Driver</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor">#define NETMAP_NT_DEVICE_NAME           L&quot;\\Device\\NETMAP&quot;</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NETMAP_DOS_DEVICE_NAME          L&quot;\\DosDevices\\netmap&quot;</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">//Definition of a structure used to pass a virtual address within an IOCTL</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>_MEMORY_ENTRY {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    PVOID       pUsermodeVirtualAddress;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;} MEMORY_ENTRY, *PMEMORY_ENTRY;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>_POLL_REQUEST_DATA {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordtype">int</span> events;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordtype">int</span> timeout;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordtype">int</span> revents;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;} POLL_REQUEST_DATA;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* _WIN32 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment"> * FreeBSD uses the size value embedded in the _IOWR to determine</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment"> * how much to copy in/out. So we need it to match the actual</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment"> * data structure we pass. We put some spares in the structure</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment"> * to ease compatibility with other versions</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00617"></a><span class="lineno"><a class="line" href="netmap_8h.html#abaaeb0d152df89b317f04ee340c27d3e">  617</a></span>&#160;<span class="preprocessor">#define NIOCGINFO   _IOWR(&#39;i&#39;, 145, struct nmreq) </span><span class="comment">/* return IF info */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00618"></a><span class="lineno"><a class="line" href="netmap_8h.html#a21d792861cc4742a871276c17e399af1">  618</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NIOCREGIF   _IOWR(&#39;i&#39;, 146, struct nmreq) </span><span class="comment">/* interface register */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00619"></a><span class="lineno"><a class="line" href="netmap_8h.html#a368c0988cb35f2b257487e64459b820b">  619</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NIOCTXSYNC  _IO(&#39;i&#39;, 148) </span><span class="comment">/* sync tx queues */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00620"></a><span class="lineno"><a class="line" href="netmap_8h.html#a624cac14dacccf5d487793bc3686df0a">  620</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NIOCRXSYNC  _IO(&#39;i&#39;, 149) </span><span class="comment">/* sync rx queues */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00621"></a><span class="lineno"><a class="line" href="netmap_8h.html#a352c34c7d416c392ae207e8a84959ac6">  621</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NIOCCONFIG  _IOWR(&#39;i&#39;,150, struct nm_ifreq) </span><span class="comment">/* for ext. modules */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* !NIOCREGIF */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment"> * Helper functions for kernel and userspace</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment"> * check if space is available in the ring.</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l00633"></a><span class="lineno"><a class="line" href="netmap_8h.html#a5fdd1b6f9d32c4d527c47a3a296fb304">  633</a></span>&#160;<a class="code" href="netmap_8h.html#a5fdd1b6f9d32c4d527c47a3a296fb304">nm_ring_empty</a>(<span class="keyword">struct</span> <a class="code" href="structnetmap__ring.html">netmap_ring</a> *ring)</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;{</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordflow">return</span> (ring-&gt;<a class="code" href="structnetmap__ring.html#a116a2a487bf4b24a2f98b9e853139105">cur</a> == ring-&gt;<a class="code" href="structnetmap__ring.html#aaf077ab220816b275a48c154570ab1ee">tail</a>);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;}</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment"> * Opaque structure that is passed to an external kernel</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment"> * module via ioctl(fd, NIOCCONFIG, req) for a user-owned</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment"> * bridge port (at this point ephemeral VALE interface).</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00643"></a><span class="lineno"><a class="line" href="netmap_8h.html#af1234879b75c0d9b9f5279a9a6ff6a42">  643</a></span>&#160;<span class="preprocessor">#define NM_IFRDATA_LEN 256</span></div>
<div class="line"><a name="l00644"></a><span class="lineno"><a class="line" href="structnm__ifreq.html">  644</a></span>&#160;<span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structnm__ifreq.html">nm_ifreq</a> {</div>
<div class="line"><a name="l00645"></a><span class="lineno"><a class="line" href="structnm__ifreq.html#a2c9a809d729f5ea7c5f14d7e56efbac6">  645</a></span>&#160;    <span class="keywordtype">char</span> <a class="code" href="structnm__ifreq.html#a2c9a809d729f5ea7c5f14d7e56efbac6">nifr_name</a>[IFNAMSIZ];</div>
<div class="line"><a name="l00646"></a><span class="lineno"><a class="line" href="structnm__ifreq.html#a61da0c20ca0c61107ffc17657f25ebd6">  646</a></span>&#160;    <span class="keywordtype">char</span> <a class="code" href="structnm__ifreq.html#a61da0c20ca0c61107ffc17657f25ebd6">data</a>[<a class="code" href="netmap_8h.html#af1234879b75c0d9b9f5279a9a6ff6a42">NM_IFRDATA_LEN</a>];</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;};</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* _NET_NETMAP_H_ */</span><span class="preprocessor"></span></div>
<div class="ttc" id="netmap_8h_html_a06fc87d81c62e9abb8790b6e5713c55bac8cca0b6844df0e5417719d9228aa5c5"><div class="ttname"><a href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55bac8cca0b6844df0e5417719d9228aa5c5">NR_REG_SW</a></div><div class="ttdef"><b>Definition:</b> netmap.h:543</div></div>
<div class="ttc" id="structnmreq_html_ae722dbbdbcb2d4a4a63c19809d09b065"><div class="ttname"><a href="structnmreq.html#ae722dbbdbcb2d4a4a63c19809d09b065">nmreq::nr_ringid</a></div><div class="ttdeci">uint16_t nr_ringid</div><div class="ttdef"><b>Definition:</b> netmap.h:505</div></div>
<div class="ttc" id="structnetmap__ring_html_ac11c6137efc7fc88ff2ff8ca413c9035"><div class="ttname"><a href="structnetmap__ring.html#ac11c6137efc7fc88ff2ff8ca413c9035">netmap_ring::slot</a></div><div class="ttdeci">struct netmap_slot slot[0]</div><div class="ttdef"><b>Definition:</b> netmap.h:308</div></div>
<div class="ttc" id="structnetmap__ring_html_a37102602c060ee425a89df961b39e208"><div class="ttname"><a href="structnetmap__ring.html#a37102602c060ee425a89df961b39e208">netmap_ring::num_slots</a></div><div class="ttdeci">const uint32_t num_slots</div><div class="ttdef"><b>Definition:</b> netmap.h:287</div></div>
<div class="ttc" id="structnmreq_html_a164625aa23e5ff67e48a81e0340e82ae"><div class="ttname"><a href="structnmreq.html#a164625aa23e5ff67e48a81e0340e82ae">nmreq::nr_rx_slots</a></div><div class="ttdeci">uint32_t nr_rx_slots</div><div class="ttdef"><b>Definition:</b> netmap.h:501</div></div>
<div class="ttc" id="structnetmap__ring_html_a92b1183e066bcd2fc65a16b8f5cd57ae"><div class="ttname"><a href="structnetmap__ring.html#a92b1183e066bcd2fc65a16b8f5cd57ae">netmap_ring::ts</a></div><div class="ttdeci">struct timeval ts</div><div class="ttdef"><b>Definition:</b> netmap.h:298</div></div>
<div class="ttc" id="structnmreq_html_ab69f153468b56318beceed7573061520"><div class="ttname"><a href="structnmreq.html#ab69f153468b56318beceed7573061520">nmreq::nr_rx_rings</a></div><div class="ttdeci">uint16_t nr_rx_rings</div><div class="ttdef"><b>Definition:</b> netmap.h:503</div></div>
<div class="ttc" id="structnetmap__ring_html_adfb2ffe7f091af3aa8d369e80de91691"><div class="ttname"><a href="structnetmap__ring.html#adfb2ffe7f091af3aa8d369e80de91691">netmap_ring::sem</a></div><div class="ttdeci">uint8_t sem[128]</div><div class="ttdef"><b>Definition:</b> netmap.h:302</div></div>
<div class="ttc" id="structnmreq_html_aeac6e7c4301879310ec3d580c9e81105"><div class="ttname"><a href="structnmreq.html#aeac6e7c4301879310ec3d580c9e81105">nmreq::nr_offset</a></div><div class="ttdeci">uint32_t nr_offset</div><div class="ttdef"><b>Definition:</b> netmap.h:498</div></div>
<div class="ttc" id="netmap_8h_html_a3b1049947637ce44a5dbc247e570302c"><div class="ttname"><a href="netmap_8h.html#a3b1049947637ce44a5dbc247e570302c">NM_CACHE_ALIGN</a></div><div class="ttdeci">#define NM_CACHE_ALIGN</div><div class="ttdef"><b>Definition:</b> netmap.h:52</div></div>
<div class="ttc" id="netmap_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba6eefc97d6fcebc35fc66038172acf8d4"><div class="ttname"><a href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba6eefc97d6fcebc35fc66038172acf8d4">NR_REG_ALL_NIC</a></div><div class="ttdef"><b>Definition:</b> netmap.h:542</div></div>
<div class="ttc" id="structnm__ifreq_html_a2c9a809d729f5ea7c5f14d7e56efbac6"><div class="ttname"><a href="structnm__ifreq.html#a2c9a809d729f5ea7c5f14d7e56efbac6">nm_ifreq::nifr_name</a></div><div class="ttdeci">char nifr_name[IFNAMSIZ]</div><div class="ttdef"><b>Definition:</b> netmap.h:645</div></div>
<div class="ttc" id="structnetmap__ring_html_a2d73ed8aacb735a74587c6d59bfa521f"><div class="ttname"><a href="structnetmap__ring.html#a2d73ed8aacb735a74587c6d59bfa521f">netmap_ring::flags</a></div><div class="ttdeci">uint32_t flags</div><div class="ttdef"><b>Definition:</b> netmap.h:296</div></div>
<div class="ttc" id="netmap_8h_html_af1234879b75c0d9b9f5279a9a6ff6a42"><div class="ttname"><a href="netmap_8h.html#af1234879b75c0d9b9f5279a9a6ff6a42">NM_IFRDATA_LEN</a></div><div class="ttdeci">#define NM_IFRDATA_LEN</div><div class="ttdef"><b>Definition:</b> netmap.h:643</div></div>
<div class="ttc" id="structnmreq_html_ac8bd987253a1cac2cb0c9df35691d17c"><div class="ttname"><a href="structnmreq.html#ac8bd987253a1cac2cb0c9df35691d17c">nmreq::nr_tx_rings</a></div><div class="ttdeci">uint16_t nr_tx_rings</div><div class="ttdef"><b>Definition:</b> netmap.h:502</div></div>
<div class="ttc" id="structnetmap__slot_html_a55cf5ec447f34d0cab46f065728a5d93"><div class="ttname"><a href="structnetmap__slot.html#a55cf5ec447f34d0cab46f065728a5d93">netmap_slot::flags</a></div><div class="ttdeci">uint16_t flags</div><div class="ttdef"><b>Definition:</b> netmap.h:168</div></div>
<div class="ttc" id="structnetmap__ring_html_a7ffcfff1be1ca50a663914184b7faecf"><div class="ttname"><a href="structnetmap__ring.html#a7ffcfff1be1ca50a663914184b7faecf">netmap_ring::buf_ofs</a></div><div class="ttdeci">const int64_t buf_ofs</div><div class="ttdef"><b>Definition:</b> netmap.h:286</div></div>
<div class="ttc" id="structnetmap__ring_html_a116a2a487bf4b24a2f98b9e853139105"><div class="ttname"><a href="structnetmap__ring.html#a116a2a487bf4b24a2f98b9e853139105">netmap_ring::cur</a></div><div class="ttdeci">uint32_t cur</div><div class="ttdef"><b>Definition:</b> netmap.h:293</div></div>
<div class="ttc" id="structnmreq_html_a471cf0759451e8f3e3ca91a35a0e5c2c"><div class="ttname"><a href="structnmreq.html#a471cf0759451e8f3e3ca91a35a0e5c2c">nmreq::nr_tx_slots</a></div><div class="ttdeci">uint32_t nr_tx_slots</div><div class="ttdef"><b>Definition:</b> netmap.h:500</div></div>
<div class="ttc" id="structnmreq_html_ab90704691a1ec4b48c23cde016bd2dc1"><div class="ttname"><a href="structnmreq.html#ab90704691a1ec4b48c23cde016bd2dc1">nmreq::nr_memsize</a></div><div class="ttdeci">uint32_t nr_memsize</div><div class="ttdef"><b>Definition:</b> netmap.h:499</div></div>
<div class="ttc" id="structnm__ifreq_html_a61da0c20ca0c61107ffc17657f25ebd6"><div class="ttname"><a href="structnm__ifreq.html#a61da0c20ca0c61107ffc17657f25ebd6">nm_ifreq::data</a></div><div class="ttdeci">char data[NM_IFRDATA_LEN]</div><div class="ttdef"><b>Definition:</b> netmap.h:646</div></div>
<div class="ttc" id="netmap_8h_html_a06fc87d81c62e9abb8790b6e5713c55bade2109b5bb9eb5377d13a3857397494f"><div class="ttname"><a href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55bade2109b5bb9eb5377d13a3857397494f">NR_REG_PIPE_MASTER</a></div><div class="ttdef"><b>Definition:</b> netmap.h:546</div></div>
<div class="ttc" id="structnmreq_html"><div class="ttname"><a href="structnmreq.html">nmreq</a></div><div class="ttdef"><b>Definition:</b> netmap.h:495</div></div>
<div class="ttc" id="structnmreq_html_acdef73623694120dcda0f6805d1ec30d"><div class="ttname"><a href="structnmreq.html#acdef73623694120dcda0f6805d1ec30d">nmreq::spare2</a></div><div class="ttdeci">uint32_t spare2[1]</div><div class="ttdef"><b>Definition:</b> netmap.h:537</div></div>
<div class="ttc" id="structnetmap__if_html_ab8b14e631b50fb480377725d2a5281c4"><div class="ttname"><a href="structnetmap__if.html#ab8b14e631b50fb480377725d2a5281c4">netmap_if::ni_tx_rings</a></div><div class="ttdeci">const uint32_t ni_tx_rings</div><div class="ttdef"><b>Definition:</b> netmap.h:352</div></div>
<div class="ttc" id="structnmreq_html_ad5ec54607ccfd57982c1d6d3285b4fba"><div class="ttname"><a href="structnmreq.html#ad5ec54607ccfd57982c1d6d3285b4fba">nmreq::nr_arg1</a></div><div class="ttdeci">uint16_t nr_arg1</div><div class="ttdef"><b>Definition:</b> netmap.h:530</div></div>
<div class="ttc" id="structnetmap__slot_html_a504f80f1df944631d75a35c67c3b747f"><div class="ttname"><a href="structnetmap__slot.html#a504f80f1df944631d75a35c67c3b747f">netmap_slot::len</a></div><div class="ttdeci">uint16_t len</div><div class="ttdef"><b>Definition:</b> netmap.h:167</div></div>
<div class="ttc" id="structnetmap__if_html"><div class="ttname"><a href="structnetmap__if.html">netmap_if</a></div><div class="ttdef"><b>Definition:</b> netmap.h:339</div></div>
<div class="ttc" id="netmap_8h_html_a06fc87d81c62e9abb8790b6e5713c55baacdc70a35aa6dffd208c6e178e6df7d7"><div class="ttname"><a href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55baacdc70a35aa6dffd208c6e178e6df7d7">NR_REG_PIPE_SLAVE</a></div><div class="ttdef"><b>Definition:</b> netmap.h:547</div></div>
<div class="ttc" id="structnmreq_html_a3ec7cdc9a7f3bb9103f2088a30c5408d"><div class="ttname"><a href="structnmreq.html#a3ec7cdc9a7f3bb9103f2088a30c5408d">nmreq::nr_name</a></div><div class="ttdeci">char nr_name[IFNAMSIZ]</div><div class="ttdef"><b>Definition:</b> netmap.h:496</div></div>
<div class="ttc" id="structnetmap__slot_html_ad179b4b3689715000c364d00abdb05b4"><div class="ttname"><a href="structnetmap__slot.html#ad179b4b3689715000c364d00abdb05b4">netmap_slot::ptr</a></div><div class="ttdeci">uint64_t ptr</div><div class="ttdef"><b>Definition:</b> netmap.h:169</div></div>
<div class="ttc" id="structnetmap__if_html_ad414fbdb730bbd001ae8ef3af8440e8f"><div class="ttname"><a href="structnetmap__if.html#ad414fbdb730bbd001ae8ef3af8440e8f">netmap_if::ni_rx_rings</a></div><div class="ttdeci">const uint32_t ni_rx_rings</div><div class="ttdef"><b>Definition:</b> netmap.h:353</div></div>
<div class="ttc" id="structnetmap__if_html_ae76d2e39d643cb6361eb1bbf8365c1b3"><div class="ttname"><a href="structnetmap__if.html#ae76d2e39d643cb6361eb1bbf8365c1b3">netmap_if::ni_bufs_head</a></div><div class="ttdeci">uint32_t ni_bufs_head</div><div class="ttdef"><b>Definition:</b> netmap.h:355</div></div>
<div class="ttc" id="structnetmap__if_html_a2faaffd8c1892bd50a6aaf6f2780240f"><div class="ttname"><a href="structnetmap__if.html#a2faaffd8c1892bd50a6aaf6f2780240f">netmap_if::ni_version</a></div><div class="ttdeci">const uint32_t ni_version</div><div class="ttdef"><b>Definition:</b> netmap.h:341</div></div>
<div class="ttc" id="structnetmap__slot_html"><div class="ttname"><a href="structnetmap__slot.html">netmap_slot</a></div><div class="ttdef"><b>Definition:</b> netmap.h:165</div></div>
<div class="ttc" id="structnmreq_html_ae12f9325eefa6832cd79cb7fd9a600df"><div class="ttname"><a href="structnmreq.html#ae12f9325eefa6832cd79cb7fd9a600df">nmreq::nr_version</a></div><div class="ttdeci">uint32_t nr_version</div><div class="ttdef"><b>Definition:</b> netmap.h:497</div></div>
<div class="ttc" id="structnetmap__slot_html_a53b5fc7beb0712b9c41f344177894ade"><div class="ttname"><a href="structnetmap__slot.html#a53b5fc7beb0712b9c41f344177894ade">netmap_slot::buf_idx</a></div><div class="ttdeci">uint32_t buf_idx</div><div class="ttdef"><b>Definition:</b> netmap.h:166</div></div>
<div class="ttc" id="structnetmap__ring_html_abe2efe17dacd91af126a1d4a63225424"><div class="ttname"><a href="structnetmap__ring.html#abe2efe17dacd91af126a1d4a63225424">netmap_ring::head</a></div><div class="ttdeci">uint32_t head</div><div class="ttdef"><b>Definition:</b> netmap.h:292</div></div>
<div class="ttc" id="netmap_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba0824e0950ee08ae8fc674bc9ddaa3a34"><div class="ttname"><a href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba0824e0950ee08ae8fc674bc9ddaa3a34">NR_REG_NIC_SW</a></div><div class="ttdef"><b>Definition:</b> netmap.h:544</div></div>
<div class="ttc" id="netmap_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba3b454164cdcee73c3cb5df91569e2d5b"><div class="ttname"><a href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba3b454164cdcee73c3cb5df91569e2d5b">NR_REG_DEFAULT</a></div><div class="ttdef"><b>Definition:</b> netmap.h:541</div></div>
<div class="ttc" id="structnetmap__ring_html_aaf077ab220816b275a48c154570ab1ee"><div class="ttname"><a href="structnetmap__ring.html#aaf077ab220816b275a48c154570ab1ee">netmap_ring::tail</a></div><div class="ttdeci">uint32_t tail</div><div class="ttdef"><b>Definition:</b> netmap.h:294</div></div>
<div class="ttc" id="structnetmap__if_html_a1dfdb80b4e21abc21e01a07b07f37cca"><div class="ttname"><a href="structnetmap__if.html#a1dfdb80b4e21abc21e01a07b07f37cca">netmap_if::ring_ofs</a></div><div class="ttdeci">const ssize_t ring_ofs[0]</div><div class="ttdef"><b>Definition:</b> netmap.h:366</div></div>
<div class="ttc" id="structnetmap__ring_html"><div class="ttname"><a href="structnetmap__ring.html">netmap_ring</a></div><div class="ttdef"><b>Definition:</b> netmap.h:280</div></div>
<div class="ttc" id="structnetmap__ring_html_a56efa3d3188e04e44733858f9b0cf6a1"><div class="ttname"><a href="structnetmap__ring.html#a56efa3d3188e04e44733858f9b0cf6a1">netmap_ring::dir</a></div><div class="ttdeci">const uint16_t dir</div><div class="ttdef"><b>Definition:</b> netmap.h:290</div></div>
<div class="ttc" id="structnetmap__if_html_a6e2f3b7e18942a7d4de5763d220ce9b2"><div class="ttname"><a href="structnetmap__if.html#a6e2f3b7e18942a7d4de5763d220ce9b2">netmap_if::ni_name</a></div><div class="ttdeci">char ni_name[IFNAMSIZ]</div><div class="ttdef"><b>Definition:</b> netmap.h:340</div></div>
<div class="ttc" id="structnetmap__ring_html_a7225b6ef5a79eb6e8df13fbe986543eb"><div class="ttname"><a href="structnetmap__ring.html#a7225b6ef5a79eb6e8df13fbe986543eb">netmap_ring::nr_buf_size</a></div><div class="ttdeci">const uint32_t nr_buf_size</div><div class="ttdef"><b>Definition:</b> netmap.h:288</div></div>
<div class="ttc" id="structnmreq_html_adbf0933ed01dfb94e36dabc9c42e82fb"><div class="ttname"><a href="structnmreq.html#adbf0933ed01dfb94e36dabc9c42e82fb">nmreq::nr_arg3</a></div><div class="ttdeci">uint32_t nr_arg3</div><div class="ttdef"><b>Definition:</b> netmap.h:534</div></div>
<div class="ttc" id="structnm__ifreq_html"><div class="ttname"><a href="structnm__ifreq.html">nm_ifreq</a></div><div class="ttdef"><b>Definition:</b> netmap.h:644</div></div>
<div class="ttc" id="structnetmap__ring_html_a9638eb5de920d539aa9a6a518e4d4827"><div class="ttname"><a href="structnetmap__ring.html#a9638eb5de920d539aa9a6a518e4d4827">netmap_ring::ringid</a></div><div class="ttdeci">const uint16_t ringid</div><div class="ttdef"><b>Definition:</b> netmap.h:289</div></div>
<div class="ttc" id="structnmreq_html_a8ea266b04964d17e204b15cd25571083"><div class="ttname"><a href="structnmreq.html#a8ea266b04964d17e204b15cd25571083">nmreq::nr_arg2</a></div><div class="ttdeci">uint16_t nr_arg2</div><div class="ttdef"><b>Definition:</b> netmap.h:533</div></div>
<div class="ttc" id="structnmreq_html_a5a45993e368a473d90286807710bc69f"><div class="ttname"><a href="structnmreq.html#a5a45993e368a473d90286807710bc69f">nmreq::nr_cmd</a></div><div class="ttdeci">uint16_t nr_cmd</div><div class="ttdef"><b>Definition:</b> netmap.h:515</div></div>
<div class="ttc" id="structnetmap__if_html_a93d2c43fb0e6b532b3139dca3a27395d"><div class="ttname"><a href="structnetmap__if.html#a93d2c43fb0e6b532b3139dca3a27395d">netmap_if::ni_spare1</a></div><div class="ttdeci">uint32_t ni_spare1[5]</div><div class="ttdef"><b>Definition:</b> netmap.h:356</div></div>
<div class="ttc" id="structnetmap__if_html_ad13b44724d6ebc70cbe733a63c96039f"><div class="ttname"><a href="structnetmap__if.html#ad13b44724d6ebc70cbe733a63c96039f">netmap_if::ni_flags</a></div><div class="ttdeci">const uint32_t ni_flags</div><div class="ttdef"><b>Definition:</b> netmap.h:342</div></div>
<div class="ttc" id="netmap_8h_html_a5fdd1b6f9d32c4d527c47a3a296fb304"><div class="ttname"><a href="netmap_8h.html#a5fdd1b6f9d32c4d527c47a3a296fb304">nm_ring_empty</a></div><div class="ttdeci">static int nm_ring_empty(struct netmap_ring *ring)</div><div class="ttdef"><b>Definition:</b> netmap.h:633</div></div>
<div class="ttc" id="netmap_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba62ea9c598020ddaa6be65cd5ba6b6578"><div class="ttname"><a href="netmap_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba62ea9c598020ddaa6be65cd5ba6b6578">NR_REG_ONE_NIC</a></div><div class="ttdef"><b>Definition:</b> netmap.h:545</div></div>
<div class="ttc" id="structnmreq_html_a5c58284511ee8b4803c25b2b319deec3"><div class="ttname"><a href="structnmreq.html#a5c58284511ee8b4803c25b2b319deec3">nmreq::nr_flags</a></div><div class="ttdeci">uint32_t nr_flags</div><div class="ttdef"><b>Definition:</b> netmap.h:535</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Feb 16 2018 13:17:48 for warpcore by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
